  <button onclick='goToMainPage()'>Back to main page</button>
  <button onclick="askFactoryReset()">Factory reset</button>
  
  <!-- /*#ifdef HW_LILYGO2CAN*/
  <div class="settings-card">
    <h3>Hardware Configuration (LILYGO)</h3>
    %GPIOOPT1_SETTING%
  </div>
  <!-- /*#endif*/ -->
  
  <!-- /*#ifndef HW_LILYGO2CAN*/
  <!-- Default hardware - no configurable GPIO -->
  <!-- /*#endif*/ -->
  
  
  

    <script>
    function goToMainPage() { 
      window.location.href = '/'; 
    }
    
    function askFactoryReset() {
      if (confirm('Are you sure you want to reset the device to factory settings? This will erase all settings and data.')) {
        var xhr = new XMLHttpRequest();
        xhr.onload = function() {
          if (this.status == 200) {
            alert('Factory reset successful. The device will now restart.');
            window.location.href = '/';
          } else {
            alert('Factory reset failed. Please try again.');
          }
        };
        xhr.onerror = function() {
          alert('An error occurred while trying to reset the device.');
        };
        xhr.open('POST', '/factoryReset', true);
        xhr.send();
      }
    }
    
    function askReboot() {
      if (confirm('Are you sure you want to reboot the device? This will restart the Battery Emulator.')) {
        var xhr = new XMLHttpRequest();
        xhr.onload = function() {
          if (this.status == 200) {
            alert('Reboot command sent. The device will restart shortly.');
            setTimeout(function() {
              window.location.href = '/';
            }, 2000);
          } else {
            alert('Reboot failed. Please try again.');
          }
        };
        xhr.onerror = function() {
          alert('An error occurred while trying to reboot the device.');
        };
        xhr.open('POST', '/reboot', true);
        xhr.send();
      }
    }
    
    // Static IP, MQTT, and Double Battery visibility handlers
    document.addEventListener('DOMContentLoaded', function() {
      const staticIpCheckbox = document.querySelector('input[name="STATICIP"]');
      const mqttCheckbox = document.querySelector('input[name="MQTTENABLED"]');
      const dblBtrCheckbox = document.querySelector('input[name="DBLBTR"]');
      const form = document.querySelector('form[action="saveSettings"]');
      
      if (staticIpCheckbox && form) {
        function updateStaticIpVisibility() {
          if (staticIpCheckbox.checked) {
            form.setAttribute('data-staticip', 'true');
          } else {
            form.setAttribute('data-staticip', 'false');
          }
        }
        
        // Add event listener for changes
        staticIpCheckbox.addEventListener('change', updateStaticIpVisibility);
        
        // Set initial state based on checkbox checked attribute
        updateStaticIpVisibility();
      }
      
      if (mqttCheckbox && form) {
        function updateMqttVisibility() {
          if (mqttCheckbox.checked) {
            form.setAttribute('data-mqttenabled', 'true');
          } else {
            form.setAttribute('data-mqttenabled', 'false');
          }
        }
        
        // Add event listener for changes
        mqttCheckbox.addEventListener('change', updateMqttVisibility);
        
        // Set initial state based on checkbox checked attribute
        updateMqttVisibility();
      }
      
      if (dblBtrCheckbox && form) {
        function updateDblBtrVisibility() {
          if (dblBtrCheckbox.checked) {
            form.setAttribute('data-dblbtr', 'true');
          } else {
            form.setAttribute('data-dblbtr', 'false');
          }
        }
        
        // Add event listener for changes
        dblBtrCheckbox.addEventListener('change', updateDblBtrVisibility);
        
        // Set initial state based on checkbox checked attribute
        updateDblBtrVisibility();
      }
    });
  </script>

<div style='background-color: #404E47; padding: 10px; margin-bottom: 10px; border-radius: 50px'>
        <form action='saveSettings' method='post' data-battery="1" data-inverter="1" data-charger="1" data-shunt="1" data-staticip="%STATICIP%" data-mqttenabled="%MQTTENABLED%" data-dblbtr="%DBLBTR%">

        <div style='grid-column: span 2; text-align: center; padding-top: 10px;' class="%SAVEDCLASS%">
          <p>Settings saved. Reboot to take the new settings into use.<p> <button type='button' onclick='askReboot()'>Reboot</button>
        </div>

        <div class="settings-card">
        <h3>Network config</h3>
        <div style='display: grid; grid-template-columns: 1fr 1.5fr; gap: 10px; align-items: center;'>

        <label>SSID: </label>
        <input type='text' name='SSID' value="%SSID%" 
        pattern="[ -~]{1,63}" 
        title="Max 63 characters, printable ASCII only"/>

        <label>Password: </label><input type='password' name='PASSWORD' value="%PASSWORD%" 
        pattern="[ -~]{8,63}" 
        title="Password must be 8-63 characters long, printable ASCII only" />
        </div>
        </div>

        <div class="settings-card">
        <h3>Battery config</h3>
        <div style='display: grid; grid-template-columns: 1fr 1.5fr; gap: 10px; align-items: center;'>

        <label for='battery'>Battery: </label>
        <select name='battery' id='battery'>
            %BATTTYPE%
        </select>

        <div class="if-nissan">
            <label for='interlock'>Interlock required: </label>
            <input type='checkbox' name='INTERLOCKREQ' id='interlock' value='on' %INTERLOCKREQ% />
        </div>

        <div class="if-tesla">
          <label for='digitalhvil'>Digital HVIL (2024+): </label>
          <input type='checkbox' name='DIGITALHVIL' id='digitalhvil' value='on' %DIGITALHVIL% />
          <label>Right hand drive: </label>
          <input type='checkbox' name='GTWRHD' value='on' %GTWRHD% />
          <label for='GTWCOUNTRY'>Country code: </label><select name='GTWCOUNTRY' id='GTWCOUNTRY'>
          %GTWCOUNTRY%
          </select>
          <label for='GTWMAPREG'>Map region: </label><select name='GTWMAPREG' id='GTWMAPREG'>
          %GTWMAPREG%
          </select>
          <label for='GTWCHASSIS'>Chassis type: </label><select name='GTWCHASSIS' id='GTWCHASSIS'>
          %GTWCHASSIS%
          </select>
          <label for='GTWPACK'>Pack type: </label><select name='GTWPACK' id='GTWPACK'>
          %GTWPACK%
          </select>
        </div>

        <div class="if-estimated">
        <label>Manual charging power, watt: </label>
        <input type='number' name='CHGPOWER' value="%CHGPOWER%" 
        min="0" max="65000" step="1"
        title="Continous max charge power. Used since CAN data not valid for this integration. Do not set too high!" />

        <label>Manual discharge power, watt: </label>
        <input type='number' name='DCHGPOWER' value="%DCHGPOWER%" 
        min="0" max="65000" step="1"
        title="Continous max discharge power. Used since CAN data not valid for this integration. Do not set too high!" />
        </div>

        <div class="if-socestimated">
        <label>Use estimated SOC: </label>
        <input type='checkbox' name='SOCESTIMATED' value='on' %SOCESTIMATED% 
        title="Switch to estimated State of Charge when accurate SOC data is not available from the battery" />
        </div>

        <div class="if-battery">
        <label for='BATTCOMM'>Battery interface: </label><select name='BATTCOMM' id='BATTCOMM'>
        %BATTCOMM%
        </select>

        <label>Battery chemistry: </label><select name='BATTCHEM'>
        %BATTCHEM%
        </select>
        </div>

        <div class="if-cbms">
        <label>Battery max design voltage (V): </label>
        <input name='BATTPVMAX' pattern="[0-9]+(\.[0-9]+)?" type='text' value='%BATTPVMAX%'   
        title="Maximum safe voltage for the entire battery pack in volts. Used as charge target and protection limits." />

        <label>Battery min design voltage (V): </label>
        <input name='BATTPVMIN' pattern="[0-9]+(\.[0-9]+)?" type='text' value='%BATTPVMIN%' 
        title="Minimum safe voltage for the entire battery pack in volts. Further discharge not possible below this limit." />

        <label>Cell max design voltage (mV): </label>
        <input name='BATTCVMAX' pattern="[0-9]+" type='text' value='%BATTCVMAX%' 
        title="Maximum voltage per individual cell in millivolts. Charging stops if one cell reaches this voltage." />

        <label>Cell min design voltage (mV): </label>
        <input name='BATTCVMIN' pattern="[0-9]+$" type='text' value='%BATTCVMIN%' 
        title="Minimum voltage per individual cell in millivolts. Discharge stops if one cell drops to this voltage." />
        </div>

        <label>Double battery: </label>
        <input type='checkbox' name='DBLBTR' value='on' %DBLBTR% 
        title="Enable this option if you intend to run two batteries in parallel" />

        <div class="if-dblbtr">
            <label>Battery 2 interface: </label>
            <select name='BATT2COMM'>
                %BATT2COMM%
            </select>
        </div>

        </div>
        </div>

        <div class="settings-card">
      <h3>Inverter config</h3>
      <div style='display: grid; grid-template-columns: 1fr 1.5fr; gap: 10px; align-items: center;'>

        <label>Inverter protocol: </label><select name='inverter'>
        %INVTYPE%
        </select>

        <div class="if-inverter">        
        <label>Inverter interface: </label><select name='INVCOMM'>
        %INVCOMM%     
        </select>
        </div>

        <div class="if-sofar">
        <label>Sofar Battery ID (0-15): </label>
        <input name='SOFAR_ID' type='text' value="%SOFAR_ID%" pattern="[0-9]{1,2}" />
        </div>

        <div class="if-pylon">
        <label>Pylon, send group (0-1): </label>
        <input name='PYLONSEND' type='text' value="%PYLONSEND%" pattern="[0-9]+" 
        title="Select if we should send ###0 or ###1 CAN messages, useful for multi-battery setups or ID problems" />

        <label>Pylon, 30k offset: </label>
        <input type='checkbox' name='PYLONOFFSET' value='on' %PYLONOFFSET% 
        title="When enabled, 30k offset will be applied on some signals, useful for some inverters that see wrong data otherwise" />

        <label>Pylon, invert byteorder: </label>
        <input type='checkbox' name='PYLONORDER' value='on' %PYLONORDER% 
        title="When enabled, byteorder will be inverted on some signals, useful for some inverters that see wrong data otherwise" />
        </div>

        <div class="if-byd">
        <label>Deye offgrid specific fixes: </label>
        <input type='checkbox' name='DEYEBYD' value='on' %DEYEBYD% />
        </div>

        <div class="if-pylonish">
        <label>Reported cell count (0 for default): </label>
        <input name='INVCELLS' type='text' value="%INVCELLS%" pattern="[0-9]+" />
        </div>

        <div class="if-pylonish if-solax">
        <label>Reported module count (0 for default): </label>
        <input name='INVMODULES' type='text' value="%INVMODULES%" pattern="[0-9]+" />
        </div>

        <div class="if-pylonish">
        <label>Reported cells per module (0 for default): </label>
        <input name='INVCELLSPER' type='text' value="%INVCELLSPER%" pattern="[0-9]+" />

        <label>Reported voltage level (0 for default): </label>
        <input name='INVVLEVEL' type='text' value="%INVVLEVEL%" pattern="[0-9]+" />

        <label>Reported Ah capacity (0 for default): </label>
        <input name='INVCAPACITY' type='text' value="%INVCAPACITY%" pattern="[0-9]+" />
        </div>

        <div class="if-solax">
        <label>Reported battery type (in decimal): </label>
        <input name='INVBTYPE' type='text' value="%INVBTYPE%" pattern="[0-9]+" />
        </div>

        <div class="if-kostal if-solax">
        <label>Prevent inverter opening contactors: </label>
        <input type='checkbox' name='INVICNT' value='on' %INVICNT% />
        </div>

        </div>
        </div>

        <div class="settings-card">
        <h3>Optional components config</h3>
        <div style='display: grid; grid-template-columns: 1fr 1.5fr; gap: 10px; align-items: center;'>

        <label>Charger: </label><select name='charger'>
        %CHGTYPE%
        </select>

        <div class="if-charger">
        <label>Charger interface: </label><select name='CHGCOMM'>
        %CHGCOMM%
        </select>
        </div>

        <label>Shunt: </label><select name='SHUNT'>
        %SHUNTTYPE%
        </select>

        <div class="if-shunt">
        <label>Shunt interface: </label><select name='SHUNTCOMM'>
        %SHUNTCOMM%
        </select>
        </div>

        </div>
        </div>

        <div class="settings-card">
        <h3>Hardware config</h3>
        <div style='display: grid; grid-template-columns: 1fr 1.5fr; gap: 10px; align-items: center;'>

        <label>Use CanFD as classic CAN: </label>
        <input type='checkbox' name='CANFDASCAN' value='on' %CANFDASCAN% 
        title="When enabled, CAN-FD channel will operate as normal 500kbps CAN" />

        <label>CAN addon crystal (Mhz): </label>
        <input type='number' name='CANFREQ' value="%CANFREQ%" 
        min="0" max="1000" step="1"
        title="Configure this if you are using a custom add-on CAN board. Integers only" />

        <label>CAN-FD-addon crystal (Mhz): </label>
        <input type='number' name='CANFDFREQ' value="%CANFDFREQ%" 
        min="0" max="1000" step="1"
        title="Configure this if you are using a custom add-on CAN board. Integers only" />
        
        <label>Equipment stop button: </label><select name='EQSTOP'>
        %EQSTOP%  
        </select>

        <div class="if-dblbtr">
            <label>Double-Battery Contactor control via GPIO: </label>
            <input type='checkbox' name='CNTCTRLDBL' value='on' %CNTCTRLDBL% />
        </div>

        <label>Contactor control via GPIO: </label>
        <input type='checkbox' name='CNTCTRL' value='on' %CNTCTRL% />

        <div class="if-cntctrl">
            <label>Precharge time ms: </label>
            <input type='number' name='PRECHGMS' value="%PRECHGMS%" 
            min="1" max="65000" step="1"
            title="Time in milliseconds the precharge should be active" />

            <label>Use Normally Closed logic: </label>
            <input type='checkbox' name='NCCONTACTOR' value='on' %NCCONTACTOR% 
            title="Extremely rare option. If configured, GPIO control logic will be inverted for operation with normally closed contactors" />

            <label>PWM contactor control: </label>
            <input type='checkbox' name='PWMCNTCTRL' value='on' %PWMCNTCTRL% />

             <div class="if-pwmcntctrl">
            <label>PWM Frequency Hz: </label>
            <input name='PWMFREQ' type='text' value="%PWMFREQ%"             
            min="1" max="65000" step="1"
            title="Frequency in Hz used for PWM" />

            <label>PWM Hold 1-1023: </label>
            <input type='number' name='PWMHOLD' value="%PWMHOLD%" 
            min="1" max="1023" step="1"
            title="1-1023 , lower value = lower power consumption" />
              </div>

        </div>

        <label>Periodic BMS reset every 24h: </label>
        <input type='checkbox' name='PERBMSRESET' value='on' %PERBMSRESET% /> 

        <label>External precharge via HIA4V1: </label>
        <input type='checkbox' name='EXTPRECHARGE' value='on' %EXTPRECHARGE% />

        <div class="if-extprecharge">
            <label>Precharge, maximum ms before fault: </label>
            <input name='MAXPRETIME' type='text' value="%MAXPRETIME%" pattern="[0-9]+" />

          <label>Normally Open (NO) inverter disconnect contactor: </label>
          <input type='checkbox' name='NOINVDISC' value='on' %NOINVDISC% />
        </div>

        <label for='LEDMODE'>Status LED pattern: </label><select name='LEDMODE' id='LEDMODE'>
        %LEDMODE%
        </select>

        </div>
        </div>

        <div class="settings-card">
        <h3>Connectivity settings</h3>
        <div style='display: grid; grid-template-columns: 1fr 1.5fr; gap: 10px; align-items: center;'>

        <label>Broadcast Wifi access point: </label>
        <input type='checkbox' name='WIFIAPENABLED' value='on' %WIFIAPENABLED% />

        <label>Access point name: </label>
        <input type='text' name='APNAME' value="%APNAME%" 
        pattern="[ -~]{1,63}" 
        title="Max 63 characters, printable ASCII only"
        required />

        <label>Access point password: </label>
        <input type='text' name='APPASSWORD' value="%APPASSWORD%" 
        pattern="[ -~]{8,63}" 
        title="Password must be 8-63 characters long, printable ASCII only"
        required />

        <label>Wifi channel 0-14: </label>
        <input type='number' name='WIFICHANNEL' value="%WIFICHANNEL%" 
        min="0" max="14" step="1"
        title="Force specific channel. Set to 0 for autodetect" required />

        <label>Custom Wifi hostname: </label>
        <input type='text' name='HOSTNAME' value="%HOSTNAME%" 
        pattern="[A-Za-z0-9\-]+"
        title="Optional: Hostname may only contain letters, numbers and '-'" />

        <label>Use static IP address: </label>
        <input type='checkbox' name='STATICIP' value='on' %STATICIP% />


<div class="if-staticip">
  <label>Local IP: </label>
  <div class="ip-row">
    <input class="octet" type="number" name="LOCALIP1" min="0" max="255" value="%LOCALIP1%">
    <span class="dot">.</span>
    <input class="octet" type="number" name="LOCALIP2" min="0" max="255" value="%LOCALIP2%">
    <span class="dot">.</span>
    <input class="octet" type="number" name="LOCALIP3" min="0" max="255" value="%LOCALIP3%">
    <span class="dot">.</span>
    <input class="octet" type="number" name="LOCALIP4" min="0" max="255" value="%LOCALIP4%">
  </div>

  <label>Gateway: </label>
  <div class="ip-row">
    <input class="octet" type="number" name="GATEWAY1" min="0" max="255" value="%GATEWAY1%">
    <span class="dot">.</span>
    <input class="octet" type="number" name="GATEWAY2" min="0" max="255" value="%GATEWAY2%">
    <span class="dot">.</span>
    <input class="octet" type="number" name="GATEWAY3" min="0" max="255" value="%GATEWAY3%">
    <span class="dot">.</span>
    <input class="octet" type="number" name="GATEWAY4" min="0" max="255" value="%GATEWAY4%">
  </div>

  <label>Subnet: </label>
  <div class="ip-row">
    <input class="octet" type="number" name="SUBNET1" min="0" max="255" value="%SUBNET1%">
    <span class="dot">.</span>
    <input class="octet" type="number" name="SUBNET2" min="0" max="255" value="%SUBNET2%">
    <span class="dot">.</span>
    <input class="octet" type="number" name="SUBNET3" min="0" max="255" value="%SUBNET3%">
    <span class="dot">.</span>
    <input class="octet" type="number" name="SUBNET4" min="0" max="255" value="%SUBNET4%">
  </div>
</div>

        <label>Enable MQTT: </label>
        <input type='checkbox' name='MQTTENABLED' value='on' %MQTTENABLED% />

        <div class='if-mqtt'>
        <label>MQTT server: </label>
        <input type='text' name='MQTTSERVER' value="%MQTTSERVER%" 
        pattern="[A-Za-z0-9.\-]+"
        title="Hostname (letters, numbers, '.', '-')" />
        <label>MQTT port: </label>
        <input type='number' name='MQTTPORT' value="%MQTTPORT%" 
        min="1" max="65535" step="1"
        title="Port number (1-65535)" />
        <label>MQTT user: </label><input type='text' name='MQTTUSER' value="%MQTTUSER%"         
        pattern="[ -~]+"
        title="MQTT username can only contain printable ASCII" />
        <label>MQTT password: </label><input type='password' name='MQTTPASSWORD' value="%MQTTPASSWORD%" 
        pattern="[ -~]+"
        title="MQTT password can only contain printable ASCII" />
        <label>MQTT timeout ms: </label>
        <input name='MQTTTIMEOUT' type='number' value="%MQTTTIMEOUT%" 
        min="1" max="60000" step="1"
        title="Timeout in milliseconds (1-60000)" />
        <label>Send all cellvoltages via MQTT: </label><input type='checkbox' name='MQTTCELLV' value='on' %MQTTCELLV% />
        <label>Remote BMS reset via MQTT allowed: </label>
        <input type='checkbox' name='REMBMSRESET' value='on' %REMBMSRESET% />
        <label>Customized MQTT topics: </label>
        <input type='checkbox' name='MQTTTOPICS' value='on' %MQTTTOPICS% />

        <div class='if-topics'>

        <label>MQTT topic name: </label><input type='text' name='MQTTTOPIC' value="%MQTTTOPIC%" />
        <label>Prefix for MQTT object ID: </label><input type='text' name='MQTTOBJIDPREFIX' value="%MQTTOBJIDPREFIX%" />
        <label>HA device name: </label><input type='text' name='MQTTDEVICENAME' value="%MQTTDEVICENAME%" />
        <label>HA device ID: </label><input type='text' name='HADEVICEID' value="%HADEVICEID%" />
        
        </div>

        <label>Enable Home Assistant auto discovery: </label>
        <input type='checkbox' name='HADISC' value='on' %HADISC% />

        </div>

        </div>
        </div>

        <div class="settings-card">
        <h3>Debug options</h3>
        <div style='display: grid; grid-template-columns: 1.5fr 1.5fr; gap: 10px; align-items: center;'>

        <label>Enable performance profiling on main page: </label>
        <input type='checkbox' name='PERFPROFILE' value='on' %PERFPROFILE%          
              title="For developers. Enable this to get detailed performance metrics on the front page" />

        <label>Enable CAN message logging via USB serial: </label>
        <input type='checkbox' name='CANLOGUSB' value='on' %CANLOGUSB%  
              title="WARNING: Causes performance issues. Enable this to get incoming/outgoing CAN messages logged via USB cable. Avoid if possible" />
        <script> //Make sure user only uses one general logging method, improves performance
        function handleCheckboxSelection(clickedCheckbox) { 
            const usbCheckbox = document.querySelector('input[name="USBENABLED"]');
            const webCheckbox = document.querySelector('input[name="WEBENABLED"]');
            
            if (clickedCheckbox.checked) {
                // If the clicked checkbox is being checked, uncheck the other one
                if (clickedCheckbox.name === 'USBENABLED') {
                    webCheckbox.checked = false;
                } else {
                    usbCheckbox.checked = false;
                }
            }
            // If unchecking, do nothing (allow both to be unchecked)
        }
        </script>

        <label>Enable general logging via USB serial: </label>
        <input type='checkbox' name='USBENABLED' value='on' %USBENABLED% 
              onclick="handleCheckboxSelection(this)" 
              title="WARNING: Causes performance issues. Enable this to get general logging via USB cable. Avoid if possible" />

        <label>Enable general logging via Webserver: </label>
        <input type='checkbox' name='WEBENABLED' value='on' %WEBENABLED% 
              onclick="handleCheckboxSelection(this)"         
              title="Enable this if you want general logging available in the Webserver" />

        <label>Enable CAN message logging via SD card: </label>
        <input type='checkbox' name='CANLOGSD' value='on' %CANLOGSD% 
        title="Enable this if you want incoming/outgoing CAN messages to be stored to an SD card. Only works on select hardware with SD-card slot" />

        <label>Enable general logging via SD card: </label>
        <input type='checkbox' name='SDLOGENABLED' value='on' %SDLOGENABLED% 
        title="Enable this if you want general logging to be stored to an SD card. Only works on select hardware with SD-card slot" />

        </div>
         </div>

        <div style='grid-column: span 2; text-align: center; padding-top: 10px;'><button type='submit'>Save</button></div>

        <div style='grid-column: span 2; text-align: center; padding-top: 10px;' class="%SAVEDCLASS%">
          <p>Settings saved. Reboot to take the new settings into use.<p> <button type='button' onclick='askReboot()'>Reboot</button>
        </div>

        </form>
    </div>
    </div>

      <h4 style='color: white;'>Battery interface: <span id='Battery'>%BATTERYINTF%</span></h4>

      <h4 style='color: white;' class="%BATTERY2CLASS%">Battery interface: <span id='Battery2'>%BATTERY2INTF%</span></h4>

      <h4 style='color: white;' class="%INVCLASS%">Inverter interface: <span id='Inverter'>%INVINTF%</span></h4>
      
      <h4 style='color: white;' class="%SHUNTCLASS%">Shunt interface: <span id='Inverter'>%SHUNTINTF%</span></h4>

    </div>

    <div style='background-color: #2D3F2F; padding: 10px; margin-bottom: 10px;border-radius: 50px'>

      <h4 style='color: white;'>Battery capacity: <span id='BATTERY_WH_MAX'>%BATTERY_WH_MAX% Wh </span> <button onclick='editWh()'>Edit</button></h4>

      <h4 style='color: white;'>Rescale SOC: <span id='BATTERY_USE_SCALED_SOC'><span class='%SOC_SCALING_CLASS%'>%SOC_SCALING%</span>
                </span> <button onclick='editUseScaledSOC()'>Edit</button></h4>

      <h4 class='%SOC_SCALING_ACTIVE_CLASS%'><span>SOC max percentage: %SOC_MAX_PERCENTAGE%</span> <button onclick='editSocMax()'>Edit</button></h4>

      <h4 class='%SOC_SCALING_ACTIVE_CLASS%'><span>SOC min percentage: %SOC_MIN_PERCENTAGE%</span> <button onclick='editSocMin()'>Edit</button></h4>
      
      <h4 style='color: white;'>Max charge speed: %MAX_CHARGE_SPEED% A </span> <button onclick='editMaxChargeA()'>Edit</button></h4>

      <h4 style='color: white;'>Max discharge speed: %MAX_DISCHARGE_SPEED% A </span><button onclick='editMaxDischargeA()'>Edit</button></h4>

      <h4 style='color: white;'>Manual charge voltage limits: <span id='BATTERY_USE_VOLTAGE_LIMITS'>
        <span class='%VOLTAGE_LIMITS_CLASS%'>%VOLTAGE_LIMITS%</span>
                </span> <button onclick='editUseVoltageLimit()'>Edit</button></h4>

      <h4 class='%VOLTAGE_LIMITS_ACTIVE_CLASS%'>Target charge voltage: %CHARGE_VOLTAGE% V </span> <button onclick='editMaxChargeVoltage()'>Edit</button></h4>

      <h4 class='%VOLTAGE_LIMITS_ACTIVE_CLASS%'>Target discharge voltage: %DISCHARGE_VOLTAGE% V </span> <button onclick='editMaxDischargeVoltage()'>Edit</button></h4>

      <h4 style='color: white;'>Periodic BMS reset off time: %BMS_RESET_DURATION% s </span><button onclick='editBMSresetDuration()'>Edit</button></h4>

    </div>

    <div style='background-color: #2E37AD; padding: 10px; margin-bottom: 10px;border-radius: 50px' class="%FAKE_VOLTAGE_CLASS%">
      <h4 style='color: white;'><span>Fake battery voltage: %BATTERY_VOLTAGE% V </span> <button onclick='editFakeBatteryVoltage()'>Edit</button></h4>
    </div>

    <!--if (battery && battery->supports_manual_balancing()) {-->
      
    <div style='background-color: #303E47; padding: 10px; margin-bottom: 10px;border-radius: 50px' class="%MANUAL_BAL_CLASS%">

          <h4 style='color: white;'>Manual LFP balancing: <span id='TSL_BAL_ACT'><span class="%MANUAL_BALANCING_CLASS%">%MANUAL_BALANCING%</span>
          </span> <button onclick='editTeslaBalAct()'>Edit</button></h4>

          <h4 class="%BALANCING_CLASS%"><span>Balancing max time: %BAL_MAX_TIME% Minutes</span> <button onclick='editBalTime()'>Edit</button></h4>

          <h4 class="%BALANCING_CLASS%"><span>Balancing float power: %BAL_POWER% W </span> <button onclick='editBalFloatPower()'>Edit</button></h4>

           <h4 class="%BALANCING_CLASS%"><span>Max battery voltage: %BAL_MAX_PACK_VOLTAGE% V</span> <button onclick='editBalMaxPackV()'>Edit</button></h4>

           <h4 class="%BALANCING_CLASS%"><span>Max cell voltage: %BAL_MAX_CELL_VOLTAGE% mV</span> <button onclick='editBalMaxCellV()'>Edit</button></h4>

          <h4 class="%BALANCING_CLASS%"><span>Max cell voltage deviation: %BAL_MAX_DEV_CELL_VOLTAGE% mV</span> <button onclick='editBalMaxDevCellV()'>Edit</button></h4>

    </div>

     <div style='background-color: #FF6E00; padding: 10px; margin-bottom: 10px;border-radius: 50px' class="%CHARGER_CLASS%">

      <h4 style='color: white;'>
        Charger HVDC Enabled: <span class="%CHG_HV_CLASS%">%CHG_HV%</span>
        <button onclick='editChargerHVDCEnabled()'>Edit</button>
      </h4>

      <h4 style='color: white;'>
        Charger Aux12VDC Enabled: <span class="%CHG_AUX12V_CLASS%">%CHG_AUX12V%</span>
        <button onclick='editChargerAux12vEnabled()'>Edit</button>
      </h4>

      <h4 style='color: white;'><span>Charger Voltage Setpoint: %CHG_VOLTAGE_SETPOINT% V </span> <button onclick='editChargerSetpointVDC()'>Edit</button></h4>

      <h4 style='color: white;'><span>Charger Current Setpoint: %CHG_CURRENT_SETPOINT% A</span> <button onclick='editChargerSetpointIDC()'>Edit</button></h4>

      </div>
    
  </div>